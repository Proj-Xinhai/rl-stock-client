import{d as U,r as n,a as F,o as u,c as d,b as t,l as h,p as b,C as f,i as k,g as a,q as y,B as S,F as w,h as N,j as B,t as s,y as D,x,s as $}from"./index-a67dff9b.js";import{P as C,t as M}from"./ploty-52330373.js";import"./_commonjsHelpers-725317a4.js";const P={class:"ts-grid is-evenly-divided"},j={class:"column ts-wrap is-vertical"},q={class:"ts-text is-label"},E={class:"ts-input is-end-labeled"},I=t("span",{class:"label"},".TW",-1),L={class:"column ts-wrap is-vertical"},W={class:"ts-text is-label"},z={class:"ts-select"},A=["value"],G={class:"column ts-wrap is-vertical"},H={class:"ts-text is-label"},J={class:"ts-input is-start-labeled"},K=t("span",{class:"label"},"$",-1),O={class:"ts-grid is-evenly-divided"},Q={class:"column ts-wrap is-vertical"},R={class:"ts-input"},X=["max"],Y={class:"ts-text is-label"},Z={class:"column ts-wrap is-vertical"},tt={class:"ts-input"},et=["min"],lt={class:"ts-text is-label"},st={class:"ts-grid is-top-aligned"},at={class:"column ts-wrap"},nt=t("div",{class:"ts-box u-top-spaced"},[t("div",{id:"backtest"})],-1),ot={class:"ts-box u-top-spaced"},it={class:"ts-table"},ut=t("thead",null,[t("tr",null,[t("th",null,"#"),t("th",null,"action"),t("th",null,"trade"),t("th",null,"balance"),t("th",null,"hold"),t("th",null,"net"),t("th",null,"reward")])],-1),dt={key:0},vt=["data-tooltip"],ct={class:"ts-text is-negative"},rt=["data-tooltip"],_t={colspan:"7"},ft=U({__name:"BacktestView",setup(pt){const _=n(""),v=n(""),c=n(""),p=n(""),o=n(null),i=n(!1),g=n(NaN),r=n([]),T=()=>{_.value==""||v.value==""||c.value==""||p.value==""||!o.value||(console.log(_.value),console.log(v.value),console.log(c.value),console.log(p.value),console.log(o.value),D.emit("backtesting",{stock:_.value,model:p.value,default_balance:o.value,start:v.value,end:c.value},(V,l,e)=>{if(!V){alert(`${l}: ${e}`);return}g.value=e.value,r.value=e.actions,C.react("backtest",[{x:r.value.map(m=>m.date),y:r.value.map(m=>m.net),mode:"lines"}],{title:e.name,template:M},{})}))};return F(()=>{C.react("backtest",[{x:[],y:[],mode:"lines"}],{title:"?",template:M},{})}),(V,l)=>(u(),d(w,null,[t("div",{class:"ts-wrap is-vertical",onMouseenter:l[7]||(l[7]=e=>i.value=!0),onMouseleave:l[8]||(l[8]=e=>i.value=!1)},[t("div",P,[t("div",j,[t("div",q,[h(f,null,{default:b(()=>[a(t("span",null,"stock",512),[[x,i.value]])]),_:1}),k(" ​ ")]),t("div",E,[a(t("input",{type:"text","onUpdate:modelValue":l[0]||(l[0]=e=>_.value=e)},null,512),[[y,_.value]]),I])]),t("div",L,[t("div",W,[h(f,null,{default:b(()=>[a(t("span",null,"model",512),[[x,i.value]])]),_:1}),k(" ​ ")]),t("div",z,[a(t("select",{"onUpdate:modelValue":l[1]||(l[1]=e=>p.value=e)},[(u(!0),d(w,null,N(B($).works.filter(e=>e.status==2&&B($).tasks.find(m=>m.name==e.task_name)),e=>(u(),d("option",{key:e.id,value:e.id},s(e.task_name)+"("+s(e.id.slice(0,7))+")",9,A))),128))],512),[[S,p.value]])])]),t("div",G,[t("div",H,[h(f,null,{default:b(()=>[a(t("span",null,"default balance",512),[[x,i.value]])]),_:1}),k(" ​")]),t("div",J,[K,a(t("input",{type:"number",min:"0","onUpdate:modelValue":l[2]||(l[2]=e=>o.value=e),onFocusout:l[3]||(l[3]=e=>o.value<=0?o.value=null:null)},null,544),[[y,o.value]])])])]),t("div",O,[t("div",Q,[t("div",R,[a(t("input",{type:"date",max:c.value,"onUpdate:modelValue":l[4]||(l[4]=e=>v.value=e)},null,8,X),[[y,v.value]])]),t("div",Y,[h(f,null,{default:b(()=>[a(t("span",null,"start",512),[[x,i.value]])]),_:1}),k(" ​ ")])]),t("div",Z,[t("div",tt,[a(t("input",{type:"date",min:v.value,"onUpdate:modelValue":l[5]||(l[5]=e=>c.value=e)},null,8,et),[[y,c.value]])]),t("div",lt,[h(f,null,{default:b(()=>[a(t("span",null,"end",512),[[x,i.value]])]),_:1}),k(" ​ ")])]),t("div",st,[t("div",at,[t("button",{class:"ts-button is-outlined",onClick:l[6]||(l[6]=()=>{})},"preload"),t("button",{class:"ts-button",onClick:T},"backtest")])])])],32),nt,t("div",ot,[t("table",it,[ut,t("tbody",null,[(u(!0),d(w,null,N(r.value,e=>(u(),d("tr",{key:e.date},[t("td",null,s(e.date),1),t("td",null,[e.trade==0?(u(),d("span",dt,[t("span",{"data-tooltip":e.original_action},"hold ",8,vt),t("del",ct,"("+s(e.action)+")",1)])):(u(),d("span",{key:1,"data-tooltip":e.original_action},s(e.action),9,rt))]),t("td",null,s(e.trade),1),t("td",null,s(e.balance),1),t("td",null,s(e.hold),1),t("td",null,s(e.net),1),t("td",null,s(e.reward),1)]))),128))]),t("tfoot",null,[t("tr",null,[t("th",_t,"roi: "+s(isNaN(g.value)?"-":g.value)+", net: "+s(isNaN(g.value)?"-":r.value[r.value.length-1].net),1)])])])])],64))}});export{ft as default};
