import{d as F,r as n,a as S,o as u,c as d,b as t,l as b,p as f,C as g,i as k,g as a,q as w,B as D,F as N,h as $,j as C,n as P,t as s,s as V,y as j,x}from"./index-0957e0ce.js";import{P as M,t as T}from"./ploty-52330373.js";import"./_commonjsHelpers-725317a4.js";const q={class:"ts-grid is-evenly-divided"},z={class:"column ts-wrap is-vertical"},E={class:"ts-text is-label"},I={class:"ts-input is-end-labeled"},L=t("span",{class:"label"},".TW",-1),W={class:"column ts-wrap is-vertical"},A={class:"ts-text is-label"},G={class:"ts-select"},H=["value"],J={class:"column ts-wrap is-vertical"},K={class:"ts-text is-label"},O={class:"ts-input is-start-labeled"},Q=t("span",{class:"label"},"$",-1),R={class:"ts-grid is-evenly-divided"},X={class:"column ts-wrap is-vertical"},Y={class:"ts-input"},Z=["max"],tt={class:"ts-text is-label"},et={class:"column ts-wrap is-vertical"},lt={class:"ts-input"},st=["min"],at={class:"ts-text is-label"},nt={class:"ts-grid is-top-aligned"},ot={class:"column ts-wrap"},it=t("div",{class:"ts-box u-top-spaced"},[t("div",{id:"backtest"})],-1),ut={class:"ts-box u-top-spaced"},dt={class:"ts-table"},vt=t("thead",null,[t("tr",null,[t("th",null,"#"),t("th",null,"action"),t("th",null,"trade"),t("th",null,"balance"),t("th",null,"hold"),t("th",null,"net"),t("th",null,"reward")])],-1),ct={key:0},rt=["data-tooltip"],_t={class:"ts-text is-negative"},pt=["data-tooltip"],mt={colspan:"7"},kt=F({__name:"BacktestView",setup(ht){const p=n(""),v=n(""),c=n(""),m=n(""),o=n(null),r=n(!1),i=n(!1),y=n(NaN),_=n([]),U=()=>{V.loading=!0,!(p.value==""||v.value==""||c.value==""||m.value==""||!o.value)&&(console.log(p.value),console.log(v.value),console.log(c.value),console.log(m.value),console.log(o.value),j.emit("backtesting",{stock:p.value,model:m.value,default_balance:o.value,start:v.value,end:c.value,deterministic:r.value},(B,l,e)=>{if(V.loading=!1,!B){alert(`${l}: ${e}`);return}y.value=e.value,_.value=e.actions,M.react("backtest",[{x:_.value.map(h=>h.date),y:_.value.map(h=>h.net),mode:"lines"}],{title:e.name,template:T},{})}))};return S(()=>{M.react("backtest",[{x:[],y:[],mode:"lines"}],{title:"?",template:T},{})}),(B,l)=>(u(),d(N,null,[t("div",{class:"ts-wrap is-vertical",onMouseenter:l[7]||(l[7]=e=>i.value=!0),onMouseleave:l[8]||(l[8]=e=>i.value=!1)},[t("div",q,[t("div",z,[t("div",E,[b(g,null,{default:f(()=>[a(t("span",null,"stock",512),[[x,i.value]])]),_:1}),k(" ​ ")]),t("div",I,[a(t("input",{type:"text","onUpdate:modelValue":l[0]||(l[0]=e=>p.value=e)},null,512),[[w,p.value]]),L])]),t("div",W,[t("div",A,[b(g,null,{default:f(()=>[a(t("span",null,"model",512),[[x,i.value]])]),_:1}),k(" ​ ")]),t("div",G,[a(t("select",{"onUpdate:modelValue":l[1]||(l[1]=e=>m.value=e)},[(u(!0),d(N,null,$(C(V).works.filter(e=>e.status==2&&C(V).tasks.find(h=>h.name==e.task_name)),e=>(u(),d("option",{key:e.id,value:e.id},s(e.task_name)+"("+s(e.id.slice(0,7))+")",9,H))),128))],512),[[D,m.value]])])]),t("div",J,[t("div",K,[b(g,null,{default:f(()=>[a(t("span",null,"default balance",512),[[x,i.value]])]),_:1}),k(" ​")]),t("div",O,[Q,a(t("input",{type:"number",min:"0","onUpdate:modelValue":l[2]||(l[2]=e=>o.value=e),onFocusout:l[3]||(l[3]=e=>o.value<=0?o.value=null:null)},null,544),[[w,o.value]])])])]),t("div",R,[t("div",X,[t("div",Y,[a(t("input",{type:"date",max:c.value,"onUpdate:modelValue":l[4]||(l[4]=e=>v.value=e)},null,8,Z),[[w,v.value]])]),t("div",tt,[b(g,null,{default:f(()=>[a(t("span",null,"start",512),[[x,i.value]])]),_:1}),k(" ​ ")])]),t("div",et,[t("div",lt,[a(t("input",{type:"date",min:v.value,"onUpdate:modelValue":l[5]||(l[5]=e=>c.value=e)},null,8,st),[[w,c.value]])]),t("div",at,[b(g,null,{default:f(()=>[a(t("span",null,"end",512),[[x,i.value]])]),_:1}),k(" ​ ")])]),t("div",nt,[t("div",ot,[t("button",{class:P(["ts-button is-circular",{"is-secondary":r.value,"is-outlined":!r.value}]),onClick:l[6]||(l[6]=e=>r.value=!r.value)},s(r.value?"deterministic":"stochastic"),3),t("button",{class:"ts-button",onClick:U},"backtest")])])])],32),it,t("div",ut,[t("table",dt,[vt,t("tbody",null,[(u(!0),d(N,null,$(_.value,e=>(u(),d("tr",{key:e.date},[t("td",null,s(e.date),1),t("td",null,[e.trade==0?(u(),d("span",ct,[t("span",{"data-tooltip":e.original_action},"hold ",8,rt),t("del",_t,"("+s(e.action)+")",1)])):(u(),d("span",{key:1,"data-tooltip":e.original_action},s(e.action),9,pt))]),t("td",null,s(e.trade),1),t("td",null,s(e.balance),1),t("td",null,s(e.hold),1),t("td",null,s(e.net),1),t("td",null,s(e.reward),1)]))),128))]),t("tfoot",null,[t("tr",null,[t("th",mt,"roi: "+s(isNaN(y.value)?"-":y.value)+", net: "+s(isNaN(y.value)?"-":_.value[_.value.length-1].net),1)])])])])],64))}});export{kt as default};
