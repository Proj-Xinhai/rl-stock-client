import{d as C,r as p,a as S,w as M,o as l,c,m as I,g as x,x as b,l as y,_ as O,b as t,n as m,F as g,h as $,t as h,p as V,y as T,k as B,s as k,u as W,A as j,j as L,f as N,i as R}from"./index-a67dff9b.js";import{t as D,P as F}from"./ploty-52330373.js";import"./_commonjsHelpers-725317a4.js";const P=["id"],U=C({__name:"TheScalar",props:{timeline:{},title:{},x:{},y:{},showOutlier:{type:Boolean}},setup(f){const a=f,r=p([]),e=p({title:a.title,template:D}),u=p({}),d=o=>{const n=o.reduce((s,w)=>s+w)/o.length,i=Math.sqrt(o.map(s=>Math.pow(s-n,2)).reduce((s,w)=>s+w)/o.length);return o.map(s=>(s>n+i*3||s<n-i*3)&&!a.showOutlier?NaN:s)},_=o=>{const n=[];let i=0,s=0;return o.forEach(w=>{isNaN(w)?n.push(NaN):(i+=w,s+=1,n.push(i/s))}),n},v=()=>{const o=d(a.y);r.value=[{x:a.x,y:o,mode:a.title.startsWith("env/roi")?"markers":"lines"}],a.title.startsWith("env/roi")&&r.value.push({x:a.x,y:_(o),mode:"lines",line:{color:"red",width:1}}),setTimeout(()=>F.react(`${a.title}_${a.timeline}`,r.value,e.value,u.value),0)};return S(()=>{v(),M(a,()=>{v()})}),(o,n)=>(l(),c("div",{id:`${a.title}_${a.timeline}`},null,8,P))}}),q={style:{position:"absolute",top:"30px",left:"-145px",height:"calc(100% - 30px)"}},A={class:"ts-wrap is-vertical",style:{position:"sticky",top:"50px"}},G={class:"ts-content is-fitted"},H={class:"ts-mask has-cursor-not-allowed"},J=t("div",{class:"ts-center"},[t("div",{class:"ts-loading is-large"})],-1),K=[J],Q=C({__name:"TheScalars",props:{uuid:{},timeline:{},timelineStatus:{}},setup(f){const a=f,r=p([]),e=p(!1),u=p(!1),d=p(!1),_=()=>{console.log("reload scalar"),u.value=!0;const v={uuid:a.uuid,gets:[a.timeline]};T.emit("get_scalar",v,o=>{o[a.timeline]&&(r.value=o[a.timeline]),e.value=!0,u.value=!1})};return S(()=>{_()}),M(()=>a.timelineStatus,()=>{_()}),(v,o)=>{const n=I("lazy-component");return l(),c(g,null,[x(y(O,{lines:3,class:"u-top-spaced"},null,512),[[b,!e.value]]),x(t("div",q,[t("div",A,[t("button",{class:"ts-button is-circular is-outlined",onClick:_},"refresh"),t("button",{class:m(["ts-button is-circular",{"is-outlined":!d.value}]),onClick:o[0]||(o[0]=i=>d.value=!d.value)},"outlier",2)])],512),[[b,r.value.length>0]]),(l(!0),c(g,null,$(r.value,i=>(l(),c("details",{key:i.group,class:"ts-accordion u-top-spaced"},[t("summary",null,h(i.group),1),(l(!0),c(g,null,$(i.data,s=>(l(),c("div",{class:"ts-box u-top-spaced",key:s.tag},[t("div",G,[y(n,null,{default:V(()=>[y(U,{timeline:v.timeline,title:s.tag,x:i.step,y:s.value,"show-outlier":d.value},null,8,["timeline","title","x","y","show-outlier"])]),_:2},1024),x(t("div",H,K,512),[[b,u.value]])])]))),128))]))),128))],64)}}}),X=["onClick"],Y=C({__name:"TheWorkExporter",props:{workId:{},wrapper:{},disabled:{type:Boolean}},setup(f){const a=f,r=()=>{k.loading=!0,T.emit("export_work",a.workId,(e,u,d)=>{if(console.log("exported"),e){const _=new Blob([d],{type:"application/zip"}),v=window.URL.createObjectURL(_);Object.assign(document.createElement("a"),{href:v,download:`${a.workId}.rlswork`}).click(),window.URL.revokeObjectURL(v)}else alert(`${u}: ${d}`);k.loading=!1})};return(e,u)=>e.wrapper=="button"?(l(),c("div",{key:0,class:m({"has-cursor-not-allowed":e.disabled})},[t("button",{class:m(["ts-button is-outlined",{"is-disabled":e.disabled}]),onClick:r},"Export",2)],2)):(l(),c("div",{key:1,class:m({"has-cursor-not-allowed":e.disabled}),onClick:u[0]||(u[0]=B(d=>console.log("テヘペロ"),["stop"]))},[t("a",{class:m(["ts-text is-link has-cursor-pointer",{"is-disabled":e.disabled}]),onClick:B(r,["stop"])},"Export",10,X)],2))}}),Z={class:"ts-wrap is-middle-aligned"},ss={class:"ts-header is-huge"},ts={class:"ts-text is-code"},es={class:"ts-timeline u-top-spaced"},as={class:"aside",style:{width:"100px"}},os={key:0,class:"ts-text is-description",style:{position:"sticky",top:"20px","z-index":"1"}},ns={key:0},is={key:1},ls={class:"indicator"},cs={class:"content"},rs={key:0,class:"ts-box u-top-spaced"},us={class:"ts-content is-tertiary"},ds={class:"ts-text is-negative"},ps=t("div",{class:"aside"},null,-1),vs={class:"indicator"},_s={class:"content"},hs={key:0,class:"ts-box u-top-spaced"},ms={class:"ts-table is-striped is-celled"},ks=t("thead",null,[t("tr",null,[t("th",{colspan:"2"},"evaluation")])],-1),ws={class:"is-collapsed"},fs={key:1,class:"ts-content is-center-aligned is-middle-aligned is-vertically-padded"},gs=t("div",{class:"ts-header is-icon has-bottom-spaced"},[t("span",{class:"ts-icon is-circle-exclamation-icon"}),R(" 404 Not Found ")],-1),$s=C({__name:"WorkView",setup(f){const a=W(),r=p({name:"",args:{name:"",algorithm:"",algorithm_args:{},learn_args:{},data_locator:"",environment:"",random_state:""},date:"",data_example:""}),e=p({id:"",task_name:"",status:0,detail:"",timeline:[],evaluation:[],date:""}),u=p(Date.now()/1e3),d=p(!0);p(!1);const _=()=>{k.tasks.length!=0&&k.works.length!=0&&(r.value=k.tasks.find(({name:n})=>n==a.currentRoute.value.params.name)||r.value,e.value=k.works.find(({id:n})=>n==a.currentRoute.value.params.id)||e.value),d.value=!k.loading&&k.connected},v=setInterval(()=>{u.value=Date.now()/1e3},1e3),o=n=>{const i=E=>String(E).padStart(2,"0"),s=Math.floor(n%60),w=Math.floor(n/60%60),z=Math.floor(n/60/60%24);return`${i(z)}h ${i(w)}m ${i(s)}s`};return S(()=>{_()}),j((n,i,s)=>{clearInterval(v),s()}),M(k,()=>{_()}),(n,i)=>e.value.id!==""?(l(),c(g,{key:0},[t("div",Z,[t("div",null,[t("div",ss,[t("span",{class:"has-cursor-pointer",onClick:i[0]||(i[0]=s=>L(a).push({name:"task",params:{name:e.value.task_name}}))},h(e.value.task_name),1)]),t("span",ts,"#"+h(e.value.id),1)]),y(Y,{wrapper:"button","work-id":e.value.id,disabled:e.value.status!==2},null,8,["work-id","disabled"])]),t("div",es,[(l(!0),c(g,null,$(e.value.timeline,s=>(l(),c("div",{key:s.name,class:m(["item",{"is-negative":s.status==-1}])},[t("div",as,[s.from!==0?(l(),c("div",os,[s.to==0?(l(),c("span",ns,h(o(u.value-s.from)),1)):(l(),c("span",is,h(o(s.to-s.from)),1))])):N("",!0)]),t("div",ls,[t("span",{class:m(["ts-icon",{"is-xmark-icon":s.status==-1,"is-plus-icon":s.status==0,"is-spinning is-spinner-icon":s.status==1,"is-check-icon":s.status==2}]),style:{position:"sticky",top:"20px","z-index":"1"}},null,2)]),t("div",cs,[R(h(s.name)+" ",1),s.status==-1?(l(),c("div",rs,[t("div",us,[t("div",ds,h(s.detail),1)])])):N("",!0),y(Q,{uuid:L(a).currentRoute.value.params.id,timeline:s.name,"timeline-status":s.status},null,8,["uuid","timeline","timeline-status"])])],2))),128)),t("div",{class:m(["item",{"is-negative":e.value.status==-1}])},[ps,t("div",vs,[t("span",{class:m(["ts-icon",{"is-xmark-icon":e.value.status==-1,"is-plus-icon":e.value.status==0,"is-spinning is-spinner-icon":e.value.status==1,"is-check-icon":e.value.status==2}])},null,2)]),t("div",_s,[t("span",{class:m(["ts-text",{"is-negative":e.value.status==-1}])},h(e.value.detail),3),e.value.evaluation.length!=0?(l(),c("div",hs,[t("table",ms,[ks,t("tbody",null,[(l(!0),c(g,null,$(e.value.evaluation,s=>(l(),c("tr",{key:s.name},[t("td",ws,h(s.name),1),t("td",null,h(s.value),1)]))),128))])])])):N("",!0)])],2)])],64)):x((l(),c("div",fs,[gs,R(" The work you are looking for does not exist. ")],512)),[[b,d.value]])}});export{$s as default};
